{"version":3,"file":"29.main.js","sources":["webpack:///./src/components/views/workers/WorkerDetail.js"],"sourcesContent":["import React, { Component } from 'react'\r\nimport { getProfileFetch } from '../../../actions'\r\nimport { connect } from 'react-redux'\r\nimport {\r\n  CForm,\r\n  CFormGroup,\r\n  CInput,\r\n  CLabel, CRow,\r\n  CCol,\r\n  CButton,\r\n  CInputFile\r\n} from \"@coreui/react\";\r\nimport DjangoCSRFToken from 'django-react-csrftoken'\r\nimport { FoxApiService } from '../../../services'\r\n\r\nconst foxApi = new FoxApiService();\r\n\r\nclass WorkerDetail extends Component {\r\n\r\n  state = {\r\n    name: \"\",\r\n    contractor: \"\",\r\n    birthday: \"\",\r\n    card_number_id: \"\",\r\n    license_number: \"\",\r\n    license_scan: \"\",\r\n    passport: \"\",\r\n    passport_scan: \"\",\r\n    safety_green_card: \"\",\r\n    safety_green_card_scan: \"\",\r\n    position_in_company: \"\",\r\n    safety_quiz_answer: \"\",\r\n    personal_declaration: \"\",\r\n    special_competency: \"\",\r\n    special_competency_scan: \"\",\r\n    registration_number: \"\",\r\n    error: false,\r\n    filename: \"\",\r\n    doc_type: \"\",\r\n    upload_files: {}\r\n  }\r\n\r\n  handleChange = event => {\r\n    this.setState({\r\n      [event.target.name]: event.target.value\r\n    });\r\n  }\r\n\r\n  handleFileUpload = event => {\r\n    const { upload_files } = this.state;\r\n    upload_files[event.target.name] = event.target.files[0];\r\n    this.setState({\r\n      upload_files: upload_files,\r\n      [event.target.name]: \"\"\r\n    }, () => console.log(this.state));\r\n  }\r\n\r\n  handleSubmit = async event => {\r\n    event.preventDefault();\r\n    this.requestData = this.state;\r\n    const { upload_files } = this.requestData\r\n    delete this.requestData.upload_files\r\n    delete this.requestData.error;\r\n    delete this.requestData.filename;\r\n    delete this.requestData.doc_type;\r\n    delete this.requestData.license_scan;\r\n    delete this.requestData.passport_scan;\r\n    delete this.requestData.safety_green_card_scan;\r\n    delete this.requestData.special_competency_scan;\r\n    delete this.requestData.safety_quiz_answer;\r\n    delete this.requestData.personal_declaration;\r\n    this.formData = new FormData\r\n    Object.entries(this.requestData).forEach(([key, value]) => {\r\n      this.formData.append(key, value);\r\n    })\r\n\r\n    upload_files ? Object.entries(upload_files).forEach(([key, value]) => {\r\n      this.formData.append(key, value)\r\n    }) : null\r\n    this.formData.entries().forEach(([key, value]) => console.log(key, value))\r\n    await foxApi.patchEntityWithFiles('workers', this.props.match.params.id, this.formData)\r\n      .then(() => {\r\n        this.props.history.goBack()\r\n      },\r\n        (error) => {\r\n          console.error(error);\r\n          this.setState({\r\n            error: 'Worker update failed!' +\r\n              ' Please check your input and try again!' +\r\n              ' In case this problem repeats, please contact your administrator!'\r\n          })\r\n        })\r\n  }\r\n\r\n  downloadFile = async (e) => {\r\n    this.setState({\r\n      filename: e.target.value,\r\n      doc_type: e.target.name\r\n    }\r\n      , () => {\r\n        foxApi.downloadWorkerDocument(this.props.match.params.id, this.state.doc_type)\r\n          .then((blob) => {\r\n            const url = window.URL.createObjectURL(new Blob([blob]));\r\n            const link = document.createElement('a');\r\n            link.href = url;\r\n            const filename = this.state.filename.split('/').pop();\r\n            link.setAttribute('download', filename);\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            link.parentNode.removeChild(link);\r\n          })\r\n          .then(() => { console.log('file downloaded') })\r\n          .catch((error) => {\r\n            console.error('File download failed!');\r\n            console.error(error)\r\n          })\r\n      }\r\n    )\r\n  }\r\n\r\n  componentDidMount = async () => {\r\n    await this.props.getProfileFetch()\r\n      .then(() => foxApi.getDetailsOf('workers', this.props.match.params.id))\r\n      .then((data) => this.setState({ ...data }))\r\n  }\r\n\r\n  render = () => {\r\n    return (\r\n      <CRow>\r\n        <CCol>\r\n          <CForm\r\n            onSubmit={this.handleSubmit}\r\n          >\r\n            <DjangoCSRFToken />\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"name\">Name</CLabel>\r\n              <CInput\r\n                id=\"name\"\r\n                name='name'\r\n                placeholder=\"Enter worker name\"\r\n                value={this.state.name}\r\n                onChange={this.handleChange}\r\n                required />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"birthday\">Birthday</CLabel>\r\n              <CInput\r\n                type=\"date\"\r\n                id=\"birthday\"\r\n                name=\"birthday\"\r\n                value={this.state.birthday}\r\n                onChange={this.handleChange}\r\n                required\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"card_number_id\">Card number ID</CLabel>\r\n              <CInput\r\n                id=\"card_number_id\"\r\n                name='card_number_id'\r\n                placeholder=\"Enter ID\"\r\n                value={this.state.card_number_id}\r\n                onChange={this.handleChange}\r\n                required />\r\n\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"license_number\">License Number</CLabel>\r\n              <CInput\r\n                id=\"license_number\"\r\n                name='license_number'\r\n                placeholder=\"Enter worker name\"\r\n                value={this.state.license_number}\r\n                onChange={this.handleChange}\r\n                required />\r\n              <CLabel htmlFor=\"license_scan\">License scan</CLabel>\r\n              <CButton\r\n                variant=\"outline\"\r\n                color=\"success\"\r\n                id=\"license_scan\"\r\n                name=\"license_scan\"\r\n                value={this.state.license_scan}\r\n                onClick={this.downloadFile}\r\n              >\r\n                Download\r\n      \t\t\t\t</CButton>\r\n              <CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n              <CInputFile id=\"license_scan\" name=\"license_scan\" onChange={this.handleFileUpload}\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"passport\">Passport</CLabel>\r\n              <CInput\r\n                id=\"passport\"\r\n                name='passport'\r\n                placeholder=\"Enter passport info\"\r\n                value={this.state.passport}\r\n                onChange={this.handleChange}\r\n                required />\r\n              <CLabel htmlFor=\"passport_scan\">Passport scan</CLabel>\r\n              <CButton\r\n                variant=\"outline\"\r\n                color=\"success\"\r\n                id=\"passport_scan\"\r\n                name=\"passport_scan\"\r\n                value={this.state.passport_scan}\r\n                onClick={this.downloadFile}\r\n              >\r\n                Download\r\n      \t\t\t\t</CButton>\r\n              <CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n              <CInputFile id=\"passport_scan\" name=\"passport_scan\" onChange={this.handleFileUpload}\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"safety_green_card\">Safety Green Card</CLabel>\r\n              <CInput\r\n                id=\"safety_green_card\"\r\n                name='safety_green_card'\r\n                placeholder=\"Enter card info\"\r\n                value={this.state.safety_green_card}\r\n                onChange={this.handleChange}\r\n              />\r\n              <CLabel htmlFor=\"safety_green_card_scan\">Safety green card scan</CLabel>\r\n              <CButton\r\n                variant=\"outline\"\r\n                color=\"success\"\r\n                id=\"safety_green_card_scan\"\r\n                name=\"safety_green_card_scan\"\r\n                value={this.state.safety_green_card_scan}\r\n                onClick={this.downloadFile}\r\n              >\r\n                Download\r\n      \t\t\t\t</CButton>\r\n              <CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n              <CInputFile id=\"safety_green_card_scan\" name=\"safety_green_card_scan\" onChange={this.handleFileUpload}\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"special_competency\">Special competency</CLabel>\r\n              <CInput\r\n                id=\"special_competency\"\r\n                name='special_competency'\r\n                placeholder=\"Enter competency\"\r\n                value={this.state.special_competency}\r\n                onChange={this.handleChange}\r\n                required />\r\n              <CLabel htmlFor=\"special_competency_scan\">Special competency scan</CLabel>\r\n              <CButton\r\n                variant=\"outline\"\r\n                color=\"success\"\r\n                id=\"special_competency_scan\"\r\n                name=\"special_competency_scan\"\r\n                value={this.state.special_competency_scan}\r\n                onClick={this.downloadFile}\r\n              >\r\n                Download\r\n      \t\t\t\t</CButton>\r\n              <CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n              <CInputFile id=\"special_competency_scan\" name=\"special_competency_scan\" onChange={this.handleFileUpload}\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"competency_issued_by\">Competency issued by</CLabel>\r\n              <CInput\r\n                id=\"competency_issued_by\"\r\n                name='competency_issued_by'\r\n                placeholder=\"Enter legal entity\"\r\n                value={this.state.competency_issued_by}\r\n                onChange={this.handleChange}\r\n                required />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"registration_number\">Registration number</CLabel>\r\n              <CInput\r\n                id=\"registration_number\"\r\n                name='registration_number'\r\n                placeholder=\"Enter registration number\"\r\n                value={this.state.registration_number}\r\n                onChange={this.handleChange}\r\n                required />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"position_in_company\">Position in Company</CLabel>\r\n              <CInput\r\n                id=\"position_in_company\"\r\n                name='position_in_company'\r\n                placeholder=\"Enter worker position\"\r\n                value={this.state.position_in_company}\r\n                onChange={this.handleChange}\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"safety_quiz_answer\">Safety quiz answer</CLabel>\r\n              <CButton\r\n                variant=\"outline\"\r\n                color=\"success\"\r\n                id=\"safety_quiz_answer\"\r\n                name=\"safety_quiz_answer\"\r\n                value={this.state.safety_quiz_answer}\r\n                onClick={this.downloadFile}\r\n              >\r\n                Download\r\n      \t\t\t\t</CButton>\r\n              <CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n              <CInputFile id=\"safety_quiz_answer\" name=\"safety_quiz_answer\" onChange={this.handleFileUpload}\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CLabel htmlFor=\"personal_declaration\">Personal declaration</CLabel>\r\n              <CButton\r\n                variant=\"outline\"\r\n                color=\"success\"\r\n                id=\"personal_declaration\"\r\n                name=\"personal_declaration\"\r\n                value={this.state.personal_declaration}\r\n                onClick={this.downloadFile}\r\n              >\r\n                Download\r\n      \t\t\t\t</CButton>\r\n              <CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n              <CInputFile id=\"personal_declaration\" name=\"personal_declaration\" onChange={this.handleFileUpload}\r\n              />\r\n            </CFormGroup>\r\n            <CFormGroup>\r\n              <CButton type=\"submit\" color=\"dark\" variant=\"outline\" block>Save changes</CButton>\r\n            </CFormGroup>\r\n            {this.state.error\r\n              ? <p>{this.state.error}</p>\r\n              : null\r\n            }\r\n          </CForm>\r\n        </CCol>\r\n      </CRow >\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    contractor: state.currentUser.id,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  getProfileFetch: () => dispatch(getProfileFetch()),\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(WorkerDetail)\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AASA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;AACA;AAsBA;AACA;AAGA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AADA;AAGA;AAAA;AACA;AACA;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AAvBA;AAAA;AAyBA;AACA;AAEA;AACA;AAAA;AACA;AADA;AAKA;AACA;AAnCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;AAoCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAKA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAyBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AAIA;AADA;AAKA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AASA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;;;;;AA/TA;AACA;AAgUA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AADA;AAAA;AACA;AAGA;;;;A","sourceRoot":""}