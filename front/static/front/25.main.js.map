{"version":3,"file":"25.main.js","sources":["webpack:///./src/components/views/workers/WorkerDetail.js"],"sourcesContent":["import React, { Component } from 'react'\r\nimport { getProfileFetch } from '../../../actions'\r\nimport { connect } from 'react-redux'\r\nimport {\r\n\tCForm,\r\n\tCFormGroup,\r\n\tCInput,\r\n\tCLabel, CRow,\r\n\tCCol,\r\n\tCButton,\r\n\tCInputFile\r\n} from \"@coreui/react\";\r\nimport DjangoCSRFToken from 'django-react-csrftoken'\r\nimport { FoxApiService } from '../../../services'\r\n\r\nconst foxApi = new FoxApiService();\r\n\r\nclass WorkerDetail extends Component {\r\n\r\n\tstate = {\r\n\t\tname: \"\",\r\n\t\tcontractor: this.props.contractor,\r\n\t\tbirthday: \"\",\r\n\t\tcard_number_id: \"\",\r\n\t\tlicense_number: \"\",\r\n\t\tlicense_scan: \"\",\r\n\t\tpassport: \"\",\r\n\t\tpassport_scan: \"\",\r\n\t\tsafety_green_card: \"\",\r\n\t\tsafety_green_card_scan: \"\",\r\n\t\tposition_in_company: \"\",\r\n\t\tsafety_quiz_answer: \"\",\r\n\t\tpersonal_declaration: \"\",\r\n\t\terror: false,\r\n\t\tfilename: \"\",\r\n\t\tdoc_type: \"\",\r\n\t\tupload_files: {}\r\n\t}\r\n\r\n\thandleChange = event => {\r\n\t\tconst { upload_files } = this.state;\r\n\t\tupload_files[event.target.name] = event.target.files[0];\r\n\t\tthis.setState({\r\n\t\t\tupload_files: upload_files,\r\n\t\t\t[event.target.name]: \"\"\r\n\t\t}, () => console.log(this.state));\r\n\t}\r\n\r\n\thandleFileUpload = event => {\r\n\t\tthis.setState({\r\n\t\t\tupload_files: { [event.target.name]: event.target.files[0] },\r\n\t\t\t[event.target.name]: \"\"\r\n\t\t}, () => console.log(this.state));\r\n\t}\r\n\r\n\thandleSubmit = async event => {\r\n\t\tevent.preventDefault();\r\n\t\tthis.requestData = this.state;\r\n\t\tconst { upload_files } = this.requestData\r\n\t\tdelete this.requestData.upload_files\r\n\t\tdelete this.requestData.error;\r\n\t\tdelete this.requestData.filename;\r\n\t\tdelete this.requestData.doc_type;\r\n\t\tdelete this.requestData.license_scan;\r\n\t\tdelete this.requestData.passport_scan;\r\n\t\tdelete this.requestData.safety_green_card_scan;\r\n\t\tdelete this.requestData.safety_quiz_answer;\r\n\t\tdelete this.requestData.personal_declaration;\r\n\t\tthis.formData = new FormData\r\n\t\tObject.entries(this.requestData).forEach(([key, value]) => {\r\n\t\t\tthis.formData.append(key, value);\r\n\t\t})\r\n\r\n\t\tupload_files ? Object.entries(upload_files).forEach(([key, value]) => {\r\n\t\t\tthis.formData.append(key, value)\r\n\t\t}) : null\r\n\t\tthis.formData.entries().forEach(([key, value]) => console.log(key, value))\r\n\t\tawait foxApi.patchEntityWithFiles('workers', this.props.match.params.id, this.formData)\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.props.history.goBack()\r\n\t\t\t},\r\n\t\t\t\t(error) => {\r\n\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\terror: 'Worker update failed!' +\r\n\t\t\t\t\t\t\t' Please check your input and try again!' +\r\n\t\t\t\t\t\t\t' In case this problem repeats, please contact your administrator!'\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t}\r\n\r\n\tdownloadFile = async (e) => {\r\n\t\tthis.setState({\r\n\t\t\tfilename: e.target.value,\r\n\t\t\tdoc_type: e.target.name\r\n\t\t}\r\n\t\t\t, () => {\r\n\t\t\t\tfoxApi.downloadWorkerDocument(this.props.match.params.id, this.state.doc_type)\r\n\t\t\t\t\t.then((blob) => {\r\n\t\t\t\t\t\tconst url = window.URL.createObjectURL(new Blob([blob]));\r\n\t\t\t\t\t\tconst link = document.createElement('a');\r\n\t\t\t\t\t\tlink.href = url;\r\n\t\t\t\t\t\tconst filename = this.state.filename.split('/').pop();\r\n\t\t\t\t\t\tlink.setAttribute('download', filename);\r\n\t\t\t\t\t\tdocument.body.appendChild(link);\r\n\t\t\t\t\t\tlink.click();\r\n\t\t\t\t\t\tlink.parentNode.removeChild(link);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(() => { console.log('file downloaded') })\r\n\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\tconsole.error('File download failed!');\r\n\t\t\t\t\t\tconsole.error(error)\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\r\n\tcomponentDidMount = async () => {\r\n\t\tawait this.props.getProfileFetch()\r\n\t\t\t.then(() => foxApi.getDetailsOf('workers', this.props.match.params.id))\r\n\t\t\t.then((data) => this.setState({ ...data }))\r\n\t}\r\n\r\n\trender = () => {\r\n\t\treturn (\r\n\t\t\t<CRow>\r\n\t\t\t\t<CCol>\r\n\t\t\t\t\t<CForm\r\n\t\t\t\t\t\tonSubmit={this.handleSubmit}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<DjangoCSRFToken />\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"name\">Name</CLabel>\r\n\t\t\t\t\t\t\t<CInput\r\n\t\t\t\t\t\t\t\tid=\"name\"\r\n\t\t\t\t\t\t\t\tname='name'\r\n\t\t\t\t\t\t\t\tplaceholder=\"Enter worker name\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.name}\r\n\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t\trequired />\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"birthday\">Birthday</CLabel>\r\n\t\t\t\t\t\t\t<CInput\r\n\t\t\t\t\t\t\t\ttype=\"date\"\r\n\t\t\t\t\t\t\t\tid=\"birthday\"\r\n\t\t\t\t\t\t\t\tname=\"birthday\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.birthday}\r\n\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"card_number_id\">Card number ID</CLabel>\r\n\t\t\t\t\t\t\t<CInput\r\n\t\t\t\t\t\t\t\tid=\"card_number_id\"\r\n\t\t\t\t\t\t\t\tname='card_number_id'\r\n\t\t\t\t\t\t\t\tplaceholder=\"Enter ID\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.card_number_id}\r\n\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t\trequired />\r\n\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"license_number\">License Number</CLabel>\r\n\t\t\t\t\t\t\t<CInput\r\n\t\t\t\t\t\t\t\tid=\"license_number\"\r\n\t\t\t\t\t\t\t\tname='license_number'\r\n\t\t\t\t\t\t\t\tplaceholder=\"Enter worker name\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.license_number}\r\n\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t\trequired />\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"license_scan\">License scan</CLabel>\r\n\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\tcolor=\"success\"\r\n\t\t\t\t\t\t\t\tid=\"license_scan\"\r\n\t\t\t\t\t\t\t\tname=\"license_scan\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.license_scan}\r\n\t\t\t\t\t\t\t\tonClick={this.downloadFile}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tDownload\r\n      \t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n\t\t\t\t\t\t\t<CInputFile id=\"license_scan\" name=\"license_scan\" onChange={this.handleFileUpload}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"passport\">Passport</CLabel>\r\n\t\t\t\t\t\t\t<CInput\r\n\t\t\t\t\t\t\t\tid=\"passport\"\r\n\t\t\t\t\t\t\t\tname='passport'\r\n\t\t\t\t\t\t\t\tplaceholder=\"Enter passport info\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.passport}\r\n\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t\trequired />\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"passport_scan\">Passport scan</CLabel>\r\n\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\tcolor=\"success\"\r\n\t\t\t\t\t\t\t\tid=\"passport_scan\"\r\n\t\t\t\t\t\t\t\tname=\"passport_scan\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.passport_scan}\r\n\t\t\t\t\t\t\t\tonClick={this.downloadFile}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tDownload\r\n      \t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n\t\t\t\t\t\t\t<CInputFile id=\"passport_scan\" name=\"passport_scan\" onChange={this.handleFileUpload}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"safety_green_card\">Safety Green Card</CLabel>\r\n\t\t\t\t\t\t\t<CInput\r\n\t\t\t\t\t\t\t\tid=\"safety_green_card\"\r\n\t\t\t\t\t\t\t\tname='safety_green_card'\r\n\t\t\t\t\t\t\t\tplaceholder=\"Enter card info\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.safety_green_card}\r\n\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"safety_green_card_scan\">Safety green card scan</CLabel>\r\n\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\tcolor=\"success\"\r\n\t\t\t\t\t\t\t\tid=\"safety_green_card_scan\"\r\n\t\t\t\t\t\t\t\tname=\"safety_green_card_scan\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.safety_green_card_scan}\r\n\t\t\t\t\t\t\t\tonClick={this.downloadFile}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tDownload\r\n      \t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n\t\t\t\t\t\t\t<CInputFile id=\"safety_green_card_scan\" name=\"safety_green_card_scan\" onChange={this.handleFileUpload}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"position_in_company\">Position in Company</CLabel>\r\n\t\t\t\t\t\t\t<CInput\r\n\t\t\t\t\t\t\t\tid=\"position_in_company\"\r\n\t\t\t\t\t\t\t\tname='position_in_company'\r\n\t\t\t\t\t\t\t\tplaceholder=\"Enter worker position\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.position_in_company}\r\n\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"safety_quiz_answer\">Safety quiz answer</CLabel>\r\n\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\tcolor=\"success\"\r\n\t\t\t\t\t\t\t\tid=\"safety_quiz_answer\"\r\n\t\t\t\t\t\t\t\tname=\"safety_quiz_answer\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.safety_quiz_answer}\r\n\t\t\t\t\t\t\t\tonClick={this.downloadFile}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tDownload\r\n      \t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n\t\t\t\t\t\t\t<CInputFile id=\"safety_quiz_answer\" name=\"safety_quiz_answer\" onChange={this.handleFileUpload}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"personal_declaration\">Personal declaration</CLabel>\r\n\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\tcolor=\"success\"\r\n\t\t\t\t\t\t\t\tid=\"personal_declaration\"\r\n\t\t\t\t\t\t\t\tname=\"personal_declaration\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.personal_declaration}\r\n\t\t\t\t\t\t\t\tonClick={this.downloadFile}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tDownload\r\n      \t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t<CLabel htmlFor=\"license_scan\">Upload new file</CLabel>\r\n\t\t\t\t\t\t\t<CInputFile id=\"personal_declaration\" name=\"personal_declaration\" onChange={this.handleFileUpload}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\r\n\r\n\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t<CButton type=\"submit\" color=\"dark\" variant=\"outline\" block>Save changes</CButton>\r\n\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t{this.state.error\r\n\t\t\t\t\t\t\t? <p>{this.state.error}</p>\r\n\t\t\t\t\t\t\t: null\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</CForm>\r\n\t\t\t\t</CCol>\r\n\t\t\t</CRow >\r\n\t\t)\r\n\t}\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n\treturn {\r\n\t\tcontractor: state.currentUser.id,\r\n\t}\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n\tgetProfileFetch: () => dispatch(getProfileFetch()),\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(WorkerDetail)"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AASA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBA;AACA;AAmBA;AAAA;AAEA;AACA;AAAA;AACA;AADA;AAGA;AAAA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAAA;AACA;AACA;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AAtBA;AAAA;AAwBA;AACA;AAEA;AACA;AAAA;AACA;AADA;AAKA;AACA;AAlCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;AAmCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAKA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAyBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AAIA;AADA;AAKA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AASA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;;;;;AAlRA;AACA;AAmRA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AADA;AAAA;AACA;AAGA;;;;A","sourceRoot":""}