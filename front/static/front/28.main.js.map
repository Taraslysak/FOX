{"version":3,"file":"28.main.js","sources":["webpack:///./src/components/views/approvals/ApprovalDetail.js"],"sourcesContent":["import React, { Component } from 'react'\r\nimport { getProfileFetch, getDocumentList } from '../../../actions'\r\nimport { connect } from 'react-redux'\r\nimport {\r\n\tCForm,\r\n\tCFormGroup,\r\n\tCLabel,\r\n\tCRow,\r\n\tCCol,\r\n\tCTextarea,\r\n\tCLink,\r\n\tCButton,\r\n\tCEmbed,\r\n\tCCard,\r\n\tCCardBody,\r\n\tCCardHeader\r\n\r\n} from \"@coreui/react\";\r\nimport DjangoCSRFToken from 'django-react-csrftoken'\r\nimport { FoxApiService } from '../../../services'\r\n\r\nconst foxApi = new FoxApiService();\r\n\r\nclass ProjectDetail extends Component {\r\n\r\n\tstate = {\r\n\t\tdescription: \"\",\r\n\t\tcreated: \"\",\r\n\t\tlast_resolved: \"\",\r\n\t\tstatus: \"\",\r\n\t\tproject: \"\",\r\n\t\tmanager: \"\",\r\n\t\terror: \"\",\r\n\t\tfilename: \"\",\r\n\t\tfile_id: \"\"\r\n\t}\r\n\r\n\thandleChange = event => {\r\n\t\tthis.setState({\r\n\t\t\t[event.target.name]: event.target.value\r\n\t\t});\r\n\t}\r\n\r\n\thandleSubmit = async event => {\r\n\t\tevent.preventDefault();\r\n\t\tif (this.state.status === \"Rejected\" && !this.state.description) {\r\n\t\t\tthis.setState({\r\n\t\t\t\terror: 'Rejections reason was not provided! Please, specify the rejection reason!'\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tthis.formData = this.state;\r\n\t\t\tdelete this.formData.error;\r\n\t\t\tdelete this.formData.created;\r\n\t\t\tdelete this.formData.last_resolved;\r\n\t\t\tawait foxApi.patchEntityOf('approvals', this.props.match.params.id, this.formData)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tthis.props.history.goBack()\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\terror: 'Project update failed!' +\r\n\t\t\t\t\t\t\t' Please check your input and try again!' +\r\n\t\t\t\t\t\t\t' In case this problem repeats, please contact your administrator!'\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tdownloadFile = async (e) => {\r\n\t\tthis.setState({\r\n\t\t\tfilename: e.target.value,\r\n\t\t\tfile_id: e.target.name\r\n\t\t}, () => {\r\n\t\t\tfoxApi.downloadDocument(this.state.file_id)\r\n\t\t\t\t.then((blob) => {\r\n\t\t\t\t\tconst url = window.URL.createObjectURL(new Blob([blob]));\r\n\t\t\t\t\tconst link = document.createElement('a');\r\n\t\t\t\t\tlink.href = url;\r\n\t\t\t\t\tconst filename = this.state.filename.split('/').pop();\r\n\t\t\t\t\tlink.setAttribute('download', filename);\r\n\t\t\t\t\tdocument.body.appendChild(link);\r\n\t\t\t\t\tlink.click();\r\n\t\t\t\t\tlink.parentNode.removeChild(link);\r\n\t\t\t\t})\r\n\t\t\t\t.then(() => { console.log('file downloaded') })\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.error('File download failed!');\r\n\t\t\t\t\tconsole.error(error)\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tcomponentDidMount = async () => {\r\n\t\tawait this.props.getProfileFetch()\r\n\t\t\t.then(() => foxApi.getDetailsOf('approvals', this.props.match.params.id))\r\n\t\t\t.then((data) => this.setState(\r\n\t\t\t\t{ ...data }, () => {\r\n\t\t\t\t\tthis.props.getDocumentList({ project_id: this.state.project }, true)\r\n\t\t\t\t}\r\n\t\t\t))\r\n\t\t// .then(() => this.props.setProjectId(this.props.match.params.id))\r\n\t}\r\n\r\n\trender = () => {\r\n\t\treturn (\r\n\t\t\t<CRow>\r\n\t\t\t\t<CCol>\r\n\t\t\t\t\t<CCard>\r\n\t\t\t\t\t\t<CCardHeader>\r\n\t\t\t\t\t\t\tAttached Documents\r\n\t\t\t\t\t\t</CCardHeader>\r\n\t\t\t\t\t\t<CCardBody>\r\n\t\t\t\t\t\t\t{this.props.documents\r\n\t\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t\tthis.props.documents.map((document, idx) => {\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t<React.Fragment key={idx}>\r\n\t\t\t\t\t\t\t\t\t\t\t<h6>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{document.name}\r\n\t\t\t\t\t\t\t\t\t\t\t</h6>\r\n\t\t\t\t\t\t\t\t\t\t\t{document.url_to_doc ?\r\n\t\t\t\t\t\t\t\t\t\t\t\t<CLink\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={`dl-${document.id}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={document.url_to_doc}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"btn btn-ghost-primary\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tOpen this document in Google Docs\r\n            \t\t\t\t\t\t</CLink>\r\n\t\t\t\t\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"primary\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={`cb-${document.id}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid={document.id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tname={document.id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={document.filename}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.downloadFile}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDownload document\r\n              \t\t\t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tnull}\r\n\t\t\t\t\t\t</CCardBody>\r\n\t\t\t\t\t</CCard>\r\n\t\t\t\t\t<CCard>\r\n\t\t\t\t\t\t<CCardBody>\r\n\t\t\t\t\t\t\t<CForm onSubmit={this.handleSubmit}>\r\n\t\t\t\t\t\t\t\t<DjangoCSRFToken />\r\n\t\t\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t\t\t<CLabel htmlFor=\"description\">Reject reason:</CLabel>\r\n\t\t\t\t\t\t\t\t\t<CTextarea\r\n\t\t\t\t\t\t\t\t\t\tid=\"description\"\r\n\t\t\t\t\t\t\t\t\t\tname=\"description\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={this.state.description ? this.state.description : \"\"}\r\n\t\t\t\t\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t</CTextarea>\r\n\t\t\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t\t\t<CFormGroup>\r\n\t\t\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"mr-3\"\r\n\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t\t\t\t\tname=\"status\"\r\n\t\t\t\t\t\t\t\t\t\tvalue=\"Approved\"\r\n\t\t\t\t\t\t\t\t\t\tcolor=\"success\"\r\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.handleChange}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tApprove\r\n\t\t\t\t\t\t\t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t\t\t<CButton\r\n\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t\t\t\t\tname=\"status\"\r\n\t\t\t\t\t\t\t\t\t\tvalue=\"Rejected\"\r\n\t\t\t\t\t\t\t\t\t\tcolor=\"danger\"\r\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.handleChange}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tReject\r\n\t\t\t\t\t\t\t\t\t</CButton>\r\n\t\t\t\t\t\t\t\t</CFormGroup>\r\n\t\t\t\t\t\t\t\t{this.state.error\r\n\t\t\t\t\t\t\t\t\t? <p>{this.state.error}</p>\r\n\t\t\t\t\t\t\t\t\t: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</CForm>\r\n\t\t\t\t\t\t</CCardBody>\r\n\t\t\t\t\t</CCard>\r\n\t\t\t\t</CCol>\r\n\t\t\t</CRow >\r\n\t\t)\r\n\t}\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n\treturn {\r\n\t\tdocuments: state.additionalEntityListTable.tableData\r\n\t}\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n\tgetProfileFetch: () => dispatch(getProfileFetch()),\r\n\tgetDocumentList: (params, additional) => dispatch(getDocumentList(params, additional)),\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ProjectDetail)\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAeA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAWA;AACA;AAGA;AACA;;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AADA;AACA;AAJA;AAAA;AACA;AADA;AAOA;AACA;AACA;AACA;AAVA;AAAA;AAaA;AACA;AAEA;AACA;AAAA;AACA;AADA;AAKA;AACA;AAvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;AAyBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAuBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AAHA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAUA;AACA;AAWA;AACA;AAAA;AAMA;AACA;AACA;AACA;AAJA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAeA;AAOA;AAAA;AAGA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAYA;AACA;AACA;AACA;AACA;AACA;AANA;AAqBA;AACA;;;;;AAjLA;AACA;AAkLA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAFA;AAAA;AACA;AAIA;;;;A","sourceRoot":""}