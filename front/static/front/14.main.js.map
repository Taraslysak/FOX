{"version":3,"file":"14.main.js","sources":["webpack:///./src/components/modals/DeleteModal.js","webpack:///./src/components/modals/index.js","webpack:///./src/components/views/special_competencies/SpecialCompetencyDetail.js"],"sourcesContent":["import React from 'react'\nimport {\n  CButton,\n  CModal,\n  CModalBody,\n  CModalFooter,\n  CModalHeader,\n  CModalTitle,\n} from '@coreui/react'\n\n\nconst DeleteModal = props => {\n  return (\n    <CModal\n      show={props.danger}\n      onClose={props.setModalVisibility}\n      color=\"danger\"\n    >\n      <CModalHeader closeButton>\n        <CModalTitle>Confirm Deletion</CModalTitle>\n      </CModalHeader>\n      <CModalBody>\n        {`Are you sure you want to delete this ${props.entity}?`}\n      </CModalBody>\n      <CModalFooter>\n        <CButton color=\"danger\" onClick={props.confirmDelete}>Confirm</CButton>{' '}\n        <CButton color=\"secondary\" onClick={props.setModalVisibility}>Cancel</CButton>\n      </CModalFooter>\n    </CModal>\n  )\n}\n\nexport default DeleteModal\n","import DeleteModal from './DeleteModal'\n\nexport { DeleteModal }","import React, { Component } from 'react'\nimport { getProfileFetch } from '../../../actions'\nimport { connect } from 'react-redux'\nimport {\n  CForm,\n  CFormGroup,\n  CInput,\n  CLabel, CRow,\n  CCol,\n  CButton,\n  CLink\n} from \"@coreui/react\";\nimport DjangoCSRFToken from 'django-react-csrftoken'\nimport { FoxApiService } from '../../../services'\nimport { FoxFormGroupInputDownloadUpload } from '../../forms'\nimport { DeleteModal } from '../../modals'\n\nconst foxApi = new FoxApiService();\n\nclass WorkerDetail extends Component {\n\n  state = {\n    worker: this.props.match.params.id,\n    name: \"\",\n    file: \"\",\n    issued_by: \"\",\n    modal: false,\n    error: false,\n    filename: \"\",\n    doc_type: \"\",\n    upload_files: {}\n  }\n\n  handleChange = event => {\n    this.setState({\n      [event.target.name]: event.target.value\n    });\n  }\n\n  handleFileUpload = event => {\n    const { upload_files } = this.state;\n    upload_files[event.target.name] = event.target.files[0];\n    this.setState({\n      upload_files: upload_files,\n      [event.target.name]: \"\"\n    });\n  }\n\n  handleSubmit = async event => {\n    event.preventDefault();\n    this.requestData = this.state;\n    const { upload_files } = this.requestData\n    delete this.requestData.modal\n    delete this.requestData.upload_files\n    delete this.requestData.error;\n    delete this.requestData.filename;\n    delete this.requestData.doc_type;\n    this.formData = new FormData\n    Object.entries(this.requestData).forEach(([key, value]) => {\n      this.formData.append(key, value);\n    });\n    upload_files ? Object.entries(upload_files).forEach(([key, value]) => {\n      this.formData.append(key, value)\n    }) : null;\n    await foxApi.patchEntityWithFiles('worker_special_competencies', this.props.match.params.competency_id, this.formData)\n      .then(() => {\n        this.props.history.goBack()\n      },\n        (error) => {\n          console.error(error);\n          this.setState({\n            error: 'Competency update failed!' +\n              ' Please check your input and try again!' +\n              ' In case this problem repeats, please contact your administrator!'\n          })\n        })\n  }\n\n  confirmDelete = async () => {\n    await foxApi.deleteEntityOf('worker_special_competencies', this.props.match.params.competency_id)\n      .then(() => {\n        this.props.history.goBack()\n      },\n        (error) => {\n          console.error(error);\n          this.setState({\n            error: 'Could not delete competency!' +\n              ' Please check your input and try again!' +\n              ' In case this problem repeats, please contact your administrator!'\n          })\n        })\n    console.log(`delete special competency ${this.props.match.params.competency_id}`);\n  }\n\n  downloadFile = async (e) => {\n    this.setState({\n      filename: e.target.value,\n      doc_type: e.target.name\n    }\n      , () => {\n        foxApi.downloadWorkerCompetency(this.props.match.params.id, this.state.doc_type)\n          .then((blob) => {\n            const url = window.URL.createObjectURL(new Blob([blob]));\n            const link = document.createElement('a');\n            link.href = url;\n            const filename = this.state.filename.split('/').pop();\n            link.setAttribute('download', filename);\n            document.body.appendChild(link);\n            link.click();\n            link.parentNode.removeChild(link);\n          })\n          .catch((error) => {\n            console.error('File download failed!');\n            console.error(error)\n          })\n      }\n    )\n  }\n\n  setModalVisibility = () => {\n    this.setState({\n      modal: !this.state.modal\n    })\n  }\n\n  componentDidMount = async () => {\n    await this.props.getProfileFetch()\n      .then(() => foxApi.getDetailsOf('worker_special_competencies', this.props.match.params.competency_id))\n      .then((data) => this.setState({ ...data }))\n  }\n\n  render = () => {\n    return (\n      <CRow>\n        <CCol>\n          <CForm\n            onSubmit={this.handleSubmit}\n          >\n            <DjangoCSRFToken />\n            <FoxFormGroupInputDownloadUpload\n              inputValue={this.state.name}\n              downloadValue={this.state.file}\n              handleChange={this.handleChange}\n              handleFileUpload={this.handleFileUpload}\n              inputInfo=\"name\"\n              uploadInfo=\"file\"\n              downloadFile={this.downloadFile}\n            />\n\n            <CFormGroup>\n              <CLabel htmlFor=\"issued_by\">Competency issued by</CLabel>\n              <CInput\n                id=\"issued_by\"\n                name='issued_by'\n                placeholder=\"Enter legal entity\"\n                value={this.state.issued_by}\n                onChange={this.handleChange}\n              />\n            </CFormGroup>\n            <CFormGroup>\n              <CButton type=\"submit\" color=\"dark\" variant=\"outline\" block>Save changes</CButton>\n            </CFormGroup>\n            <CButton className=\"mb-3\" color=\"danger\" variant=\"outline\" onClick={this.setModalVisibility} block>Delete Competency</CButton>\n            {this.state.error\n              ? <p>{this.state.error}</p>\n              : null\n            }\n          </CForm>\n          <DeleteModal\n            setModalVisibility={this.setModalVisibility}\n            danger={this.state.modal}\n            entity=\"special competency\"\n            confirmDelete={this.confirmDelete}\n          />\n        </CCol>\n      </CRow >\n    )\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    contractor: state.currentUser.id,\n  }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  getProfileFetch: () => dispatch(getProfileFetch()),\n})\n\nexport default connect(mapStateToProps, mapDispatchToProps)(WorkerDetail)\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AASA;AACA;AAEA;AACA;AACA;AAHA;AAKA;AAAA;AAOA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AACA;AACA;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAWA;AACA;AAGA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AADA;AAIA;AACA;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAfA;AAAA;AAkBA;AACA;AAEA;AACA;AAAA;AACA;AADA;AAKA;AACA;AA5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AA6BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAEA;AACA;AAAA;AACA;AADA;AAKA;AACA;AAbA;AAaA;AACA;AAdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;AAeA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAKA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAwBA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AAIA;AADA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAWA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AASA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AAJA;AASA;AACA;;;;;AA/JA;AACA;AAgKA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AADA;AAAA;AACA;AAGA;;;;A","sourceRoot":""}